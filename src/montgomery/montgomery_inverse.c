#include "montgomery/montgomery_inverse.h"
#include "constants/montgomery.h"
#include "montgomery/montgomery_multiplication.h"
#include "structs/big_uint.h"
#include <stdio.h>

void montgomery_inverse(const Uint256 *a_mont, Uint256 *a_inv_mont)
{
    /*
    Given a_mont = a * R mod N
    The result will be:

    a_inv_mont = a_inv * R mod N

    Where:

    a * a_inv mod N = 1  (modular inverse)

    This uses Fermat's Little Theorem to compute the modular inverse.

    To get a_mount ^ (N-2) mod N we use the same addition chain used by peterdettman in 2014
    (https://github.com/bitcoin-core/secp256k1/commit/f8ccd9befdb22824ef9a845a90e3db57c1307c11)
*/

    Uint256 tmp_0, tmp_1, tmp_2, tmp_3, tmp_4;

    montgomery_multiplication(a_mont, a_mont, &tmp_0);
    montgomery_multiplication(&tmp_0, a_mont, &tmp_1);
    montgomery_multiplication(&tmp_1, &tmp_1, &tmp_0);
    montgomery_multiplication(&tmp_0, a_mont, &tmp_2);
    montgomery_multiplication(&tmp_2, &tmp_2, &tmp_0);
    montgomery_multiplication(&tmp_0, &tmp_0, &tmp_0);
    montgomery_multiplication(&tmp_0, &tmp_0, &tmp_0);
    montgomery_multiplication(&tmp_0, &tmp_2, &tmp_0);
    montgomery_multiplication(&tmp_0, &tmp_0, &tmp_3);
    montgomery_multiplication(&tmp_3, &tmp_3, &tmp_3);
    montgomery_multiplication(&tmp_3, &tmp_3, &tmp_0);
    montgomery_multiplication(&tmp_0, &tmp_2, &tmp_0);
    montgomery_multiplication(&tmp_0, &tmp_0, &tmp_3);
    montgomery_multiplication(&tmp_3, &tmp_3, &tmp_0);
    montgomery_multiplication(&tmp_0, &tmp_1, &tmp_3);
    montgomery_multiplication(&tmp_3, &tmp_3, &tmp_0);
    montgomery_multiplication(&tmp_0, &tmp_0, &tmp_0);
    montgomery_multiplication(&tmp_0, &tmp_0, &tmp_0);
    montgomery_multiplication(&tmp_0, &tmp_0, &tmp_0);
    montgomery_multiplication(&tmp_0, &tmp_0, &tmp_0);
    montgomery_multiplication(&tmp_0, &tmp_0, &tmp_0);
    montgomery_multiplication(&tmp_0, &tmp_0, &tmp_0);
    montgomery_multiplication(&tmp_0, &tmp_0, &tmp_0);
    montgomery_multiplication(&tmp_0, &tmp_0, &tmp_0);
    montgomery_multiplication(&tmp_0, &tmp_0, &tmp_0);
    montgomery_multiplication(&tmp_0, &tmp_0, &tmp_0);
    montgomery_multiplication(&tmp_0, &tmp_3, &tmp_0);
    montgomery_multiplication(&tmp_0, &tmp_0, &tmp_3);
    montgomery_multiplication(&tmp_3, &tmp_3, &tmp_3);
    montgomery_multiplication(&tmp_3, &tmp_3, &tmp_3);
    montgomery_multiplication(&tmp_3, &tmp_3, &tmp_3);
    montgomery_multiplication(&tmp_3, &tmp_3, &tmp_3);
    montgomery_multiplication(&tmp_3, &tmp_3, &tmp_3);
    montgomery_multiplication(&tmp_3, &tmp_3, &tmp_3);
    montgomery_multiplication(&tmp_3, &tmp_3, &tmp_3);
    montgomery_multiplication(&tmp_3, &tmp_3, &tmp_3);
    montgomery_multiplication(&tmp_3, &tmp_3, &tmp_3);
    montgomery_multiplication(&tmp_3, &tmp_3, &tmp_3);
    montgomery_multiplication(&tmp_3, &tmp_3, &tmp_3);
    montgomery_multiplication(&tmp_3, &tmp_3, &tmp_3);
    montgomery_multiplication(&tmp_3, &tmp_3, &tmp_3);
    montgomery_multiplication(&tmp_3, &tmp_3, &tmp_3);
    montgomery_multiplication(&tmp_3, &tmp_3, &tmp_3);
    montgomery_multiplication(&tmp_3, &tmp_3, &tmp_3);
    montgomery_multiplication(&tmp_3, &tmp_3, &tmp_3);
    montgomery_multiplication(&tmp_3, &tmp_3, &tmp_3);
    montgomery_multiplication(&tmp_3, &tmp_3, &tmp_3);
    montgomery_multiplication(&tmp_3, &tmp_3, &tmp_3);
    montgomery_multiplication(&tmp_3, &tmp_3, &tmp_3);
    montgomery_multiplication(&tmp_3, &tmp_0, &tmp_3);
    montgomery_multiplication(&tmp_3, &tmp_3, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_3, &tmp_4);
    montgomery_multiplication(&tmp_4, &tmp_4, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, &tmp_4, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, &tmp_3, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, &tmp_2, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, &tmp_0, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, &tmp_1, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_inv_mont, a_inv_mont);
    montgomery_multiplication(a_inv_mont, a_mont, a_inv_mont);
}
